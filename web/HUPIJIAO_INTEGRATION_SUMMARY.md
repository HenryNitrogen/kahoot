# è™çš®æ¤’æ”¯ä»˜å®æ”¯ä»˜æ¥å…¥å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„åŠŸèƒ½

### 1. æ ¸å¿ƒæœåŠ¡æ–‡ä»¶
- âœ… `lib/utils/tools.ts` - å·¥å…·å‡½æ•°ï¼ˆæ—¶é—´æˆ³ã€UUIDç”Ÿæˆç­‰ï¼‰
- âœ… `lib/hupijiaoPayment.ts` - è™çš®æ¤’æ”¯ä»˜å®æ”¯ä»˜æ ¸å¿ƒæœåŠ¡ç±»
- âœ… `lib/payment/index.ts` - ç±»å‹å®šä¹‰å’Œå¯¼å‡º

### 2. API æ¥å£
- âœ… `app/api/payment/hupijiao/create/route.ts` - åˆ›å»ºæ”¯ä»˜è®¢å•
- âœ… `app/api/payment/hupijiao/notify/route.ts` - æ”¯ä»˜å›è°ƒé€šçŸ¥å¤„ç†
- âœ… `app/api/payment/hupijiao/query/route.ts` - æŸ¥è¯¢æ”¯ä»˜çŠ¶æ€

### 3. å‰ç«¯ç»„ä»¶
- âœ… `components/HupijiaoPayment.tsx` - æ”¯ä»˜ç»„ä»¶
- âœ… `app/payment/test/page.tsx` - æ”¯ä»˜æµ‹è¯•é¡µé¢
- âœ… `app/payment/success/page.tsx` - æ”¯ä»˜æˆåŠŸé¡µé¢

### 4. é…ç½®æ–‡ä»¶
- âœ… ç¯å¢ƒå˜é‡é…ç½®å·²æ·»åŠ åˆ° `.env.local`
- âœ… ä¾èµ–åŒ…å®‰è£…å®Œæˆï¼ˆmd5, @types/md5ï¼‰
- âœ… è·¯ç”±é›†æˆåˆ° dashboard é¡µé¢

## ğŸ”§ éœ€è¦é…ç½®çš„ç¯å¢ƒå˜é‡

åœ¨ `.env.local` æ–‡ä»¶ä¸­ï¼Œå°†ä»¥ä¸‹é…ç½®æ›¿æ¢ä¸ºçœŸå®çš„è™çš®æ¤’å‚æ•°ï¼š

```bash
# è™çš®æ¤’æ”¯ä»˜é…ç½®
HUPIJIAO_APPID="ä½ çš„è™çš®æ¤’APPID"           # æ›¿æ¢è¿™é‡Œ
HUPIJIAO_APP_SECRET="ä½ çš„è™çš®æ¤’å¯†é’¥"       # æ›¿æ¢è¿™é‡Œ
HUPIJIAO_GATEWAY_URL="https://api.xunhupay.com/payment/do.html"
HUPIJIAO_QUERY_URL="https://api.xunhupay.com/payment/query.html"
```

## ğŸ“ å¦‚ä½•è·å–é…ç½®ä¿¡æ¯

1. è®¿é—® [è™çš®æ¤’å®˜ç½‘](https://xunhupay.com) æ³¨å†Œè´¦å·
2. åœ¨å•†æˆ·åå°è·å– `APPID` å’Œ `APP_SECRET`
3. å°†è¿™äº›ä¿¡æ¯å¡«å…¥ `.env.local` æ–‡ä»¶

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬æ”¯ä»˜æµç¨‹
```typescript
import HupijiaoPayment from '@/components/HupijiaoPayment';

<HupijiaoPayment
  order_id="ORDER_123456"
  money={1.00}
  title="æµ‹è¯•å•†å“"
  onPaymentSuccess={(data) => console.log('æ”¯ä»˜æˆåŠŸ', data)}
  onPaymentError={(error) => console.error('æ”¯ä»˜å¤±è´¥', error)}
/>
```

### 2. æµ‹è¯•æ”¯ä»˜åŠŸèƒ½
- è®¿é—® `/payment/test` é¡µé¢è¿›è¡Œæµ‹è¯•
- ä» dashboard çš„å¿«é€Ÿæ“ä½œä¸­ç‚¹å‡»"è™çš®æ¤’æ”¯ä»˜æµ‹è¯•"

### 3. API è°ƒç”¨ç¤ºä¾‹
```javascript
// åˆ›å»ºæ”¯ä»˜è®¢å•
const response = await fetch('/api/payment/hupijiao/create', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    order_id: 'ORDER_123',
    money: 1.00,
    title: 'å•†å“åç§°'
  })
});
```

## ğŸ”„ æ”¯ä»˜æµç¨‹è¯´æ˜

1. **å‰ç«¯å‘èµ·æ”¯ä»˜** â†’ è°ƒç”¨ `/api/payment/hupijiao/create`
2. **æœåŠ¡å™¨åˆ›å»ºè®¢å•** â†’ è°ƒç”¨è™çš®æ¤’APIè·å–æ”¯ä»˜é“¾æ¥
3. **ç”¨æˆ·è·³è½¬æ”¯ä»˜** â†’ è®¿é—®æ”¯ä»˜é“¾æ¥å®Œæˆæ”¯ä»˜
4. **è™çš®æ¤’å›è°ƒ** â†’ é€šçŸ¥ `/api/payment/hupijiao/notify`
5. **å¤„ç†ä¸šåŠ¡é€»è¾‘** â†’ æ›´æ–°è®¢å•çŠ¶æ€ã€å¢åŠ ç§¯åˆ†ç­‰
6. **ç”¨æˆ·è·³è½¬æˆåŠŸé¡µ** â†’ æ˜¾ç¤ºæ”¯ä»˜æˆåŠŸä¿¡æ¯

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

- âœ… MD5ç­¾åéªŒè¯æ‰€æœ‰è¯·æ±‚å’Œå›è°ƒ
- âœ… å¯†é’¥å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ä¸­
- âœ… å›è°ƒé€šçŸ¥éªŒç­¾ç¡®ä¿æ•°æ®æ¥æºå¯é 
- âœ… é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

## ğŸ“‹ æ”¯æŒçš„æ”¯ä»˜æ–¹å¼

- âœ… æ”¯ä»˜å®H5æ”¯ä»˜ï¼ˆæ‰‹æœºç«¯ï¼‰
- âœ… æ”¯ä»˜å®æ‰«ç æ”¯ä»˜ï¼ˆPCç«¯ï¼‰

## ğŸ”— ç›¸å…³é“¾æ¥

- [è™çš®æ¤’å®˜ç½‘](https://xunhupay.com)
- [APIæ–‡æ¡£è¯¦æƒ…](./HUPIJIAO_PAYMENT.md)
- QQç¾¤ï¼š295292794
- å¾®ä¿¡å®¢æœï¼šhupijiao007

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æµ‹è¯•ç¯å¢ƒ**: å»ºè®®ä½¿ç”¨å°é‡‘é¢ï¼ˆå¦‚0.01å…ƒï¼‰è¿›è¡Œæµ‹è¯•
2. **è®¢å•å·**: ç¡®ä¿æ¯ä¸ªè®¢å•å·åœ¨ç³»ç»Ÿä¸­æ˜¯å”¯ä¸€çš„
3. **å›è°ƒå¤„ç†**: å¿…é¡»è¿”å› "success" å­—ç¬¦ä¸²ï¼Œå¦åˆ™ä¼šé‡å¤é€šçŸ¥
4. **ä¸šåŠ¡é€»è¾‘**: åœ¨ `handlePaymentSuccess` å‡½æ•°ä¸­æ·»åŠ å…·ä½“çš„ä¸šåŠ¡å¤„ç†é€»è¾‘

## ğŸ“ˆ ä¸‹ä¸€æ­¥

åœ¨ `/api/payment/hupijiao/notify/route.ts` çš„ `handlePaymentSuccess` å‡½æ•°ä¸­æ·»åŠ ä½ çš„å…·ä½“ä¸šåŠ¡é€»è¾‘ï¼š

```typescript
async function handlePaymentSuccess(data: NotifyData) {
  // TODO: æ ¹æ®å®é™…ä¸šåŠ¡éœ€æ±‚å®ç°
  // 1. æ ¹æ®è®¢å•å·æŸ¥è¯¢è®¢å•ä¿¡æ¯
  // 2. æ›´æ–°è®¢å•çŠ¶æ€
  // 3. å¢åŠ ç”¨æˆ·ç§¯åˆ†/ä¼šå‘˜æ—¶é•¿
  // 4. å‘é€æ”¯ä»˜æˆåŠŸé€šçŸ¥
  // 5. è®°å½•æ”¯ä»˜æ—¥å¿—
}
```

## âœ… æ„å»ºçŠ¶æ€
âœ… é¡¹ç›®ç¼–è¯‘æˆåŠŸï¼Œæ‰€æœ‰æ¥å£å¯æ­£å¸¸ä½¿ç”¨
